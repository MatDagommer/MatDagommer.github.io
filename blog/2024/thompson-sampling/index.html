<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Thompson Sampling | Matthieu Dagommer </title> <meta name="author" content="Matthieu Dagommer"> <meta name="description" content="A method to accelerate ultra-large library screening"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://matdagommer.github.io/blog/2024/thompson-sampling/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?bf50d6d9dd867d3e0f3b0add94449649"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Matthieu </span> Dagommer </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Thompson Sampling</h1> <p class="post-meta"> June 18, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/active"> <i class="fa-solid fa-hashtag fa-sm"></i> Active</a>   <a href="/blog/tag/learning"> <i class="fa-solid fa-hashtag fa-sm"></i> Learning,</a>   <a href="/blog/tag/synthons"> <i class="fa-solid fa-hashtag fa-sm"></i> Synthons,</a>   <a href="/blog/tag/ml"> <i class="fa-solid fa-hashtag fa-sm"></i> ML,</a>   <a href="/blog/tag/algorithm"> <i class="fa-solid fa-hashtag fa-sm"></i> Algorithm,</a>   <a href="/blog/tag/multi-armed"> <i class="fa-solid fa-hashtag fa-sm"></i> Multi-armed</a>   <a href="/blog/tag/bandit"> <i class="fa-solid fa-hashtag fa-sm"></i> bandit,</a>   <a href="/blog/tag/optimization"> <i class="fa-solid fa-hashtag fa-sm"></i> Optimization</a>     ·   <a href="/blog/category/ml"> <i class="fa-solid fa-tag fa-sm"></i> ML</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/thompson_sampling-480.webp 480w,/assets/img/thompson_sampling-800.webp 800w,/assets/img/thompson_sampling-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/thompson_sampling.jpeg" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Screening of molecular libraries is usually performed to identify compounds with good properties. For moderately sized libraries (&lt;\(10^9\) compounds) and scoring functions that are fast at inference, it is possible to screen the entire library in a matter of hours. However, things get more complicated with ultra-large libraries (&gt;\(10^9\) compounds) and for scoring functions that take some time, like docking calculations.</p> <p>In this <a href="https://pubs.acs.org/doi/10.1021/acs.jcim.3c01790" rel="external nofollow noopener" target="_blank">paper</a>, the authors propose Thompson sampling (TS) as a technique to explore synthesis-on-demand databases, which are libraries containing all the reactants. These libraries are efficient because they don’t require all the products to be stored but offer the possibility to retrieve them by combining the reactants. For reactions with 2 reactants, with a library of \(10^6\) reactants where all reactants can be paired, you save yourself the trouble of storing \(5 \times 10^11\) molecules in memory. Practical.</p> <p><strong>Note:</strong> The combination of reactants is not trivial and requires some additional tools that 1. All reagents (“synthons”) are synthesizable or commonly available and 2. A method to predict the reaction product. This is what tools like the SynthOn library do (it is non-trivial, and would deserve a dedicated post).</p> <p>Similar to the UCB algorithm I discussed <a href="https://matdagommer.github.io/blog/2024/bayes-UCB-algorithm/">previously</a>, TS is a Bayesian approach that can be used to solve the multi-armed bandit problem: in the face of multiple choices (arms), TS samples rewards from the reward distribution of each arm. The arm with the maximum sampled reward gets selected, and its reward distribution gets updated after scoring (Bayesian belief update, posterior distribution).</p> <p>The cool thing the paper does is tweak TS slightly to make it work for library screening. Each arm represents a reactant, and an action consists of selecting \(n\) arms for a reaction with \(n\) reactants. The reactants are selected by taking the \(n\) highest sampled rewards among the \(N\) arms. After that, the reactants are combined, and the resulting product is scored. The trick is that the \(n\) arms’ distributions are updated with that same score.</p> <p>This way, you can develop individual reward distributions for each reactant that indicate whether a reactant is likely to give satisfactory products when combined with other molecules. Through multiple iterations, the algorithm tries and tests combinations that are more likely to yield satisfactory results, which can help constitute a library of good candidates.</p> <p><strong>Remark:</strong> In their implementation, the authors use Gaussian priors with fixed variance for the reward distributions. This is the same distribution used in the Bayes-UCB algorithm from Wang et al.</p> <p>The authors tested it on three datasets for three different problems: a Tanimoto similarity search using the Niementowski quinazoline library, a 3D similarity search using the Enamine REAL collection, and a docking prediction using the Enamine library <strong>m_22bba</strong>. In each case, the authors were able to screen less than 1% of possible reagent combinations and still retrieve over 50% of the best compounds (the assessment was possible by conducting an exhaustive search on the side).</p> <p>In this <a href="https://www.biorxiv.org/content/10.1101/2024.05.16.594622v1.full.pdf" rel="external nofollow noopener" target="_blank">preprint</a>, Zhao et al. propose stochastic wheel roulette selection to improve the performance of TS. Their idea consists of converting reagents’ samples into probabilities using the Boltzmann formula and then sampling the reagent space using this new probability. It proved quite successful on the Niementowski quinazoline library for Tanimoto search: by exploring 0.01% of the library, the authors were able to retrieve 100% of the hits (versus 90% for TS). The method has yet to be tested on the other two, more challenging datasets but this is a promising start.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/bayes-UCB-algorithm/">Bayes-UCB algorithm</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/gaussian-processes/">Gaussian Processes</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/decision-trees/">Decision trees in 6 minutes</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/displaying-external-posts-on-your-al-folio-blog/">Displaying External Posts on Your al-folio Blog</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Matthieu Dagommer. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?7254ae07fe9cc5f3a10843e1c0817c9c" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>